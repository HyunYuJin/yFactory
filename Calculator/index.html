<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./styles.css">
  <title>Calculator</title>
</head>
<body>
  <div class="calculator">
    <form class="calculator__form" name="formula">
      <input type="text" class="calculator__formula" readonly name="formula" value="0" />
      <span class="calculator__btn calculator__clear" onclick="clearFormula()"><i>C</i></span>
      <span class="calculator__btn calculator__operator" data-value="/"><i>/</i></span>
      <span class="calculator__btn calculator__operator" data-value="*"><i>*</i></span>
      <span class="calculator__btn calculator__number" data-value="7"><i>7</i></span>
      <span class="calculator__btn calculator__number" data-value="8"><i>8</i></span>
      <span class="calculator__btn calculator__number" data-value="9"><i>9</i></span>
      <span class="calculator__btn calculator__operator" data-value="-"><i>-</i></span>
      <span class="calculator__btn calculator__number" data-value="4"><i>4</i></span>
      <span class="calculator__btn calculator__number" data-value="5"><i>5</i></span>
      <span class="calculator__btn calculator__number" data-value="6"><i>6</i></span>
      <span class="calculator__btn calculator__operator" data-value="+"><i>+</i></span>
      <span class="calculator__btn calculator__number" data-value="1"><i>1</i></span>
      <span class="calculator__btn calculator__number" data-value="2"><i>2</i></span>
      <span class="calculator__btn calculator__number" data-value="3"><i>3</i></span>
      <span class="calculator__btn calculator__number" data-value="0"><i>0</i></span>
      <span class="calculator__btn calculator__number" data-value="00"><i>00</i></span>
      <span class="calculator__btn calculator__number" data-value="."><i>.</i></span>

      <span class="calculator__btn calculator__result" onclick="resultFormula()"><i>=</i></span>
    </form>
  </div>

  <script>
    'use strict'

    const nodes = {
      calculator: document.querySelector('.calculator__form'),
      formula: document.querySelector('.calculator__formula'),
      result: document.querySelector('.calculator__result')
    }

    const nums = []
    let value = ''

    document.addEventListener('click', (event) => {
      const { target } = event

      const button = target.closest('.calculator__btn')
      const number = target.closest('.calculator__number')
      const operator = target.closest('.calculator__operator')
   
      if (!button) return
      if (!nodes.calculator.contains(button)) return

      if (number) {
        const value = number.dataset.value
        inputNum(value)
      } else if (operator) {
        const value = operator.dataset.value
        inputOperator(value)
      }
    })

    // 자리수
    const digits = () => {

      value += number

      return value
    }
    
    // join으로도 할 수 있지 않을까??
    // push만해주는거지...
    const inputNum = (number) => {
      const { formula } = nodes

      if (formula.value.charAt(0) === '0') {
        formula.value = ''
      }
      
      value += number
      formula.value += number
    }

    const inputOperator = (operator) => {
      const { formula } = nodes
      
      const last = formula.value.slice(-1)
      const reg = /[\+\-\/\*\.]$/

      nums.push(value)
      nums.push(operator)

      console.log(nums)

      value = ''

      if (reg.test(formula.value)) {
        formula.value = formula.value.replace(/.$/, operator)
      } else {
        formula.value += operator
      }

      if (formula.value) {
        console.log(formula.value, nums)
        console.log(value)
      }
    }

    // 실제 사용자한테 보여지는 부분만 관리함
    const displayFormula = (value) => {
      const { formula } = nodes

      formula.value = value
    }

    const clearFormula = () => {
      const { formula } = nodes

      value = ''
      formula.value = '0'
    }

    const resultFormula = () => {
      if (value) {
        nums.push(value)
      }
      
      while (nums.length > 1) {
        const formula = nums.splice(0, 3)
        const left = Number(formula[0])
        const right = Number(formula[2])
        const operator = formula[1]
        let result = 0

        if (operator === '+') {
          result = left + right
        } else if (operator === '-') {
          result = left - right
        } else if (operator === '*') {
          result = left * right
        } else {
          result = left / right
        }

        nums.unshift(result)
      }

      const { formula } = nodes
      formula.value = [...nums]

      value = ''

      console.log(nums)
    }
  </script>
</body>
</html>